{% extends "base.html" %}
{% block content %}
  <!-- Dashboard Header -->
  <div class="mb-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8">
      <!-- Title Section -->
      <div>
        <h2 class="text-4xl font-bold text-slate-900 dark:text-white mb-3">Python DSA Dashboard</h2>
        <div class="flex flex-wrap gap-4">
          <span class="badge-info"><i class="fas fa-code mr-2"></i>{{ total_demos or 134 }} demos</span>
          <span class="badge-info"><i class="fas fa-folder mr-2"></i>{{ categories|length or 17 }} categories</span>
          {% if remaining_todos %}
            <span class="badge-warning"><i class="fas fa-tasks mr-2"></i>{{ remaining_todos }} TODOs</span>
          {% endif %}
        </div>
      </div>

      <!-- Search and Filter -->
      <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
        <div class="relative flex-1 sm:flex-none">
          <input
            type="search"
            id="global-search"
            placeholder="Search..."
            class="search-input w-full"
            autocomplete="off"
            aria-label="Search all content"
          />
          <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none"></i>
        </div>

        <select id="category-filter" class="filter-select" aria-label="Filter by category">
          <option value="">All Categories</option>
          {% for category in categories.keys() %}
            <option value="{{ category }}">{{ category|title }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>

  {% if not categories %}
    <!-- Empty State -->
    <div class="flex flex-col items-center justify-center py-16 px-4 text-center">
      <div class="text-6xl mb-4">ðŸ“Š</div>
      <h3 class="text-2xl font-bold text-slate-900 dark:text-white mb-2">No demos discovered</h3>
      <p class="text-slate-600 dark:text-slate-400 mb-4">Ensure modules under <code class="bg-slate-200 dark:bg-slate-700 px-2 py-1 rounded">src/</code> define a <code class="bg-slate-200 dark:bg-slate-700 px-2 py-1 rounded">demo()</code> function.</p>
    </div>
  {% else %}
    <!-- Demo Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="content-grid">
      {% for category, demos in categories.items() %}
        {% for d in demos %}
          <article class="demo-card group"
                   data-category="{{ category }}"
                   data-id="{{ d.id }}"
                   data-search-text="{{ (d.title + ' ' + category + ' ' + d.id|string)|lower }}">

            <!-- Card Header -->
            <div class="flex items-start justify-between mb-3 pb-3 border-b border-slate-200 dark:border-slate-700">
              <div class="flex-1">
                <div class="inline-block px-2 py-1 text-xs font-medium rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-900 dark:text-blue-200 mb-2">
                  {{ category|title }}
                </div>
                <h3 class="demo-card-title">{{ d.title }}</h3>
              </div>
            </div>

            <!-- Card Description -->
            <div class="mb-4">
              {% if d.get('tags') %}
                <div class="flex flex-wrap gap-1 mb-3">
                  {% for tag in d.tags[:2] %}
                    <span class="inline-block px-2 py-1 text-xs bg-slate-700 dark:bg-slate-700 text-slate-200 dark:text-slate-300 rounded">
                      {{ tag }}
                    </span>
                  {% endfor %}
                  {% if d.tags|length > 2 %}
                    <span class="inline-block px-2 py-1 text-xs text-slate-500 dark:text-slate-400">
                      +{{ d.tags|length - 2 }}
                    </span>
                  {% endif %}
                </div>
              {% endif %}
              <p class="demo-card-description">
                {% if d.get('notes') and d.notes %}
                  {{ d.notes[:120] }}{% if d.notes|length > 120 %}...{% endif %}
                {% else %}
                  Algorithm implementation with demo and complexity analysis.
                {% endif %}
              </p>
            </div>

            <!-- Card Actions -->
            <div class="flex gap-2 pt-4 border-t border-slate-200 dark:border-slate-700">
              {% if category == 'visualizations' or (d.id|string).startswith('viz.') %}
                {% if d.id == 'viz.sorting' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_sorting') }}">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% elif d.id == 'viz.graph' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_graph') }}?algo=bfs">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% elif d.id == 'viz.path' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_path') }}?algo=astar">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% elif d.id == 'viz.arrays' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_arrays') }}?algo=binary_search">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% elif d.id == 'viz.mst' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_mst') }}?algo=kruskal">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% elif d.id == 'viz.topo' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_topo') }}?algo=kahn">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% elif d.id == 'viz.nn' %}
                  <a class="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors text-center" href="{{ url_for('viz_nn') }}?dataset=blobs">
                    <i class="fas fa-rocket mr-1"></i> Launch
                  </a>
                {% endif %}
                <a class="px-3 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-medium rounded-lg transition-colors" href="{{ url_for('source') }}?module={{ d.id }}" aria-label="View Source">
                  <i class="fas fa-code"></i>
                </a>
              {% else %}
                <button class="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white text-sm font-medium rounded-lg transition-colors" onclick="runDemo('{{ d.id }}', '{{ d.title }}')" aria-label="Run Demo">
                  <i class="fas fa-play mr-1"></i> Run
                </button>
                {% set viz_key = sorting_viz_map.get(d.id) if sorting_viz_map else None %}
                {% if viz_key %}
                  <a class="px-3 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-medium rounded-lg transition-colors" href="{{ url_for('viz_sorting') }}?algo={{ viz_key }}" aria-label="Visualize">
                    <i class="fas fa-chart-bar"></i>
                  </a>
                {% endif %}
                <a class="px-3 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-medium rounded-lg transition-colors" href="{{ url_for('source') }}?module={{ d.id }}" aria-label="View Source">
                  <i class="fas fa-code"></i>
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      {% endfor %}
    </div>

  {% endif %}

  <script>
    // Search and Filter functionality
    (function() {
      const searchInput = document.getElementById('global-search');
      const categoryFilter = document.getElementById('category-filter');
      const allCards = Array.from(document.querySelectorAll('[data-id]'));

      // Get view parameter from URL
      const urlParams = new URLSearchParams(window.location.search);
      const viewParam = urlParams.get('view');

      function filterCards() {
        const searchQuery = searchInput.value.toLowerCase().trim();
        const selectedCategory = categoryFilter.value;

        allCards.forEach(card => {
          const matchesSearch = searchQuery === '' || (card.dataset.searchText || '').includes(searchQuery);
          const matchesCategory = selectedCategory === '' || card.dataset.category === selectedCategory;
          
          // Handle view parameter filtering
          let matchesView = true;
          if (viewParam === 'visualizations') {
            matchesView = card.dataset.category === 'visualizations';
          } else if (viewParam === 'algorithms') {
            matchesView = card.dataset.category !== 'visualizations';
          }
          
          card.hidden = !(matchesSearch && matchesCategory && matchesView);
        });
      }

      // Run filter on page load to apply view parameter
      filterCards();

      if (searchInput) searchInput.addEventListener('input', filterCards);
      if (categoryFilter) categoryFilter.addEventListener('change', filterCards);
    })();
  </script>
{% endblock %}
