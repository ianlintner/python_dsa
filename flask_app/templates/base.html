<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ title or "Python DSA Demos" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <script>
    (function() {
      try {
        var saved = localStorage.getItem('theme');
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
        document.documentElement.style.setProperty('--transition-theme', 'color 180ms ease, background-color 180ms ease, border-color 180ms ease');
      } catch (e) {}
    })();
  </script>

  <!-- Bootstrap 5.3.2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <a class="skip-link" href="#content">Skip to content</a>

  <header class="site-header header" role="banner">
    <div class="container header__container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between gap-4 flex-wrap">
      <h1 class="brand header__brand"><a class="header__brand-link" href="{{ url_for('index') }}">Python DSA Demos</a></h1>
      {% set ep = request.endpoint %}
      <nav class="primary-nav nav nav--primary flex flex-wrap items-center gap-2 text-sm" aria-label="Main">
        <a href="{{ url_for('index') }}"
           class="{{ 'active' if ep == 'index' else '' }}"
           {% if ep == 'index' %}aria-current="page"{% endif %}>Dashboard</a>
        <a href="{{ url_for('index') }}?view=algorithms"
           class="{{ 'active' if request.args.get('view') == 'algorithms' else '' }}">Algorithms & Leetcode</a>
        <a href="{{ url_for('index') }}?view=visualizations"
           class="{{ 'active' if request.args.get('view') == 'visualizations' else '' }}">Visualizations</a>
        <a href="{{ url_for('big_o_guide') }}"
           class="{{ 'active' if ep == 'big_o_guide' else '' }}"
           {% if ep == 'big_o_guide' %}aria-current="page"{% endif %}>Big-O Guide</a>
        {% if meta %}
          <a href="{{ url_for('source', module=meta.id) }}"
             class="{{ 'active' if ep == 'source' else '' }}"
             {% if ep == 'source' %}aria-current="page"{% endif %}>View Source</a>
        {% endif %}
        <a class="repo" href="https://github.com/ianlintner/python_dsa" target="_blank" rel="noopener">GitHub</a>
        <a href="/docs/" target="_blank" rel="noopener">Docs</a>
      </nav>
      <div class="header-actions header__actions">
        <label for="theme-select" class="visually-hidden">Theme</label>
        <select id="theme-select" class="theme-select header__theme-select" aria-label="Select theme">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="cyberpunk">Cyberpunk</option>
        </select>
      </div>
    </div>
  </header>

  <main id="content" class="container main mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 my-6" tabindex="-1">
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer footer" role="contentinfo">
    <div class="container footer__container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
      <p>Flask UI for algorithm demos discovered under src/ (modules exposing demo()).</p>
    </div>
  </footer>

  <!-- Demo Output Modal -->
  <div class="modal fade" id="demoOutputModal" tabindex="-1" aria-labelledby="demoOutputModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="demoOutputModalLabel">Demo Output</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="demoLoadingSpinner" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Running demo...</p>
          </div>
          <div id="demoOutputContent" class="d-none">
            <pre class="demo-output-code"><code></code></pre>
          </div>
          <div id="demoErrorContent" class="d-none alert alert-danger">
            <h6 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h6>
            <pre class="demo-error-code mb-0"><code></code></pre>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      var select = document.getElementById('theme-select');
      if (!select) return;

      function getTheme() {
        return document.documentElement.getAttribute('data-theme') || 'dark';
      }
      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        try { localStorage.setItem('theme', theme); } catch(e) {}
        // Update select UI state
        select.value = theme;
      }

      // Initialize select value from current theme
      setTheme(getTheme());

      select.addEventListener('change', function(e) {
        var next = e.target.value;
        setTheme(next);
      });
    })();
  </script>
</body>
</html>
