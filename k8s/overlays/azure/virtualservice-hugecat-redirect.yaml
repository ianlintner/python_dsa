apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: hugecat-root-redirect
  labels:
    app.kubernetes.io/name: hugecat-root-redirect
    app.kubernetes.io/component: edge-routing
  annotations:
    # Redirect all requests for the apex domain hugecat.net to cat-herding.net
    # Permanent 301; preserves original path and query string.
    # NOTE: Ensure the Gateway serves hugecat.net. If only dsa.hugecat.net is configured, add hugecat.net host.
spec:
  hosts:
    - hugecat.net
  gateways:
    - python-dsa-gateway
  http:
    - match:
        - uri:
            prefix: /
      redirect:
        authority: cat-herding.net
        scheme: https
        # If you want temporary redirects, change at application layer; Istio uses 302 by default
        # Istio does not expose redirectCode directly; to force 301 use response headers from EnvoyFilter if needed.
        # This basic config typically results in 302; if 301 explicitly needed, add an EnvoyFilter patch.
